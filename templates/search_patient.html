{% extends "layout.html" %}

{% block title %}
    Search Patients
{% endblock %}

{% block main %}
    <h2 class="mb-4">üîç Search Patients</h2>

    <input type="text" id="searchBox" placeholder="Type to search..." 
           class="form-control w-50 mb-3 mx-auto">

    <table class="table table-striped table-bordered w-75 mx-auto">
        <thead class="table-dark">
            <tr>
                <th>Patient Name</th>
                <th>Room Number</th>
                <th>Patient Code</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="patientsTable">
            <tr>
                <td colspan="3" class="text-center">Loading patients...</td>
            </tr>
        </tbody>
    </table>

    <script>
    async function fetchPatients(query="") {
        const res = await fetch(`/api/search_patient?q=${encodeURIComponent(query)}`);
        const data = await res.json();

        let tableBody = document.getElementById("patientsTable");
        tableBody.innerHTML = "";

        if (data.patients && data.patients.length > 0) {
            data.patients.forEach(p => {
                let row = `<tr>
                    <td>${p.patient_name}</td>
                    <td>${p.room_number}</td>
                    <td>${p.patient_code}</td>
                    <td>
                        <a href="/patient_detail/${p.patient_code}" 
                           class="btn btn-info btn-sm">View</a>
                        <a href="/update_patient/${p.patient_code}" 
                            class="btn btn-warning btn-sm">Update</a>
                    </td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        } else {
            tableBody.innerHTML = `<tr>
                <td colspan="3" class="text-center">No patients found.</td>
            </tr>`;
        }
    }

    // initial load
    fetchPatients();

    // live search
    document.getElementById("searchBox").addEventListener("keyup", e => {
        fetchPatients(e.target.value);
    });
    </script>
{% endblock %}
