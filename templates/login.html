{% extends "layout.html" %}

{% block title %}
    Log In
{% endblock %}

{% block main %}
<form action="/login" method="post" class="mx-auto" style="max-width: 400px;">
    <div class="mb-3">
        <input autocomplete="off" autofocus class="form-control" 
               name="identifier" placeholder="Email or Mobile Number" type="text" required>
    </div>
    <div class="mb-3 input-group">
        <input class="form-control" id="login_password" name="password" placeholder="Password" type="password" required>
        <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('login_password', this)">üëÅÔ∏è</button>
    </div>
    <button class="btn btn-primary w-100" type="submit" disabled>Log In</button>
</form>

<script>
function togglePassword(fieldId, btn) {
    const field = document.getElementById(fieldId);
    if (field.type === "password") {
        field.type = "text";
        btn.textContent = "üôà";
    } else {
        field.type = "password";
        btn.textContent = "üëÅÔ∏è";
    }
}

document.addEventListener("DOMContentLoaded", function () {
    const identifierInput = document.querySelector("input[name='identifier']");
    const loginBtn = document.querySelector("button[type='submit']");
    const helpText = document.createElement("small");

    helpText.style.display = "block";
    helpText.style.marginTop = "5px";
    identifierInput.parentNode.appendChild(helpText);

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const phoneRegex = /^[7-9]\d{9}$/; // Indian phone numbers starting 7‚Äì9, exactly 10 digits
    const reservedAdminPhone = "5000000005";

    identifierInput.addEventListener("input", () => {
        const value = identifierInput.value.trim();

        if (emailRegex.test(value)) {
            helpText.textContent = "‚úÖ Valid Email detected.";
            helpText.style.color = "green";
            loginBtn.disabled = false;
        } 
        else if (phoneRegex.test(value) || value === reservedAdminPhone) {
            if (value === reservedAdminPhone) {
                helpText.textContent = "‚úÖ Reserved Admin Number detected.";
            } else {
                helpText.textContent = "‚úÖ Valid Indian Mobile Number detected.";
            }
            helpText.style.color = "green";
            loginBtn.disabled = false;
        } 
        else {
            helpText.textContent = "‚ùå Enter a valid Email or 10-digit Mobile Number (starting with 7‚Äì9).";
            helpText.style.color = "red";
            loginBtn.disabled = true;
        }
    });
});
</script>
{% endblock %}
