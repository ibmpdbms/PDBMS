{% extends "layout.html" %}

{% block title %}
    Add Patient Record
{% endblock %}

{% block main %}
    <h1 class="mb-4">➕ Add Patient Record</h1>

    <form action="/add_patient" method="post" class="w-75 mx-auto text-start">

        <div class="mb-3">
            <label for="patient_name" class="form-label">Patient Name</label>
            <input class="form-control" name="patient_name" type="text" required>
            <small class="form-text text-muted">
                The system will generate a unique Patient Code automatically.
            </small>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="age" class="form-label">Age</label>
                <input class="form-control" id="age" name="age" type="number" min="0" max="100" required>
                <div id="ageFeedback" class="form-text text-danger"></div>
            </div>
            <div class="col-md-6 mb-3">
                <label for="patient_contact_number" class="form-label">Patient Contact Number</label>
                <input class="form-control" id="patient_contact_number" name="patient_contact_number" type="tel" maxlength="10" required>
                <div id="patientPhoneFeedback" class="form-text text-danger"></div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="emergency_contact_name" class="form-label">Emergency Contact Name</label>
                <input class="form-control" name="emergency_contact_name" type="text" required>
            </div>
            <div class="col-md-6 mb-3">
                <label for="emergency_contact" class="form-label">Emergency Contact Number</label>
                <input class="form-control" id="emergency_contact" name="emergency_contact" type="tel" maxlength="10" required>
                <div id="emergencyPhoneFeedback" class="form-text text-danger"></div>
            </div>
        </div>

        <div class="mb-3">
            <label for="blood_group" class="form-label">Blood Group</label>
            <select class="form-control" name="blood_group" required>
                <option value="" disabled selected>Select blood group</option>
                <option>A+</option>
                <option>A-</option>
                <option>B+</option>
                <option>B-</option>
                <option>AB+</option>
                <option>AB-</option>
                <option>O+</option>
                <option>O-</option>
            </select>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="weight" class="form-label">Weight (kg)</label>
                <input class="form-control" name="weight" type="number">
            </div>
            <div class="col-md-6 mb-3">
                <label for="height" class="form-label">Height (cm)</label>
                <input class="form-control" name="height" type="number">
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Allergies</label>
            <textarea class="form-control auto-expand" name="allergies" rows="2" style="resize: none;"></textarea>
        </div>
        <div class="mb-3">
            <label class="form-label">Past Treatments</label>
            <textarea class="form-control auto-expand" name="past_treatments" rows="2" style="resize: none;"></textarea>
        </div>
        <div class="mb-3">
            <label class="form-label">Past Diseases</label>
            <textarea class="form-control auto-expand" name="past_diseases" rows="2" style="resize: none;"></textarea>
        </div>

        <div class="mb-3">
            <label class="form-label">Doctor Name</label>
            <input class="form-control" name="doctor_name" type="text">
        </div>
        <div class="mb-3">
            <label class="form-label">Room Number</label>
            <input class="form-control" name="room_number" type="text">
        </div>
        <div class="mb-3">
            <label class="form-label">Past Doctor Name</label>
            <input class="form-control" name="past_doctor_name" type="text">
        </div>
        <div class="mb-3">
            <label class="form-label">Insurance Company</label>
            <input class="form-control" name="insurance_company" type="text">
        </div>
        <div class="mb-3">
            <label class="form-label">Doctor Notes</label>
            <textarea class="form-control auto-expand" name="doctor_notes" rows="3" style="resize: none;"></textarea>
            <small class="form-text text-muted">
                Notes about patient condition, advice, or observations.
            </small>
        </div>

        <button class="btn btn-primary" type="submit">Save Record</button>
    </form>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const ageField = document.getElementById("age");
    const ageFeedback = document.getElementById("ageFeedback");

    const patientPhone = document.getElementById("patient_contact_number");
    const patientPhoneFeedback = document.getElementById("patientPhoneFeedback");

    const emergencyPhone = document.getElementById("emergency_contact");
    const emergencyPhoneFeedback = document.getElementById("emergencyPhoneFeedback");

    // Age validation
    ageField.addEventListener("input", () => {
        if (ageField.value === "") {
            ageFeedback.textContent = "❌ Age is required.";
        } else if (ageField.value < 0 || ageField.value > 100) {
            ageFeedback.textContent = "❌ Age must be between 0 and 100.";
        } else {
            ageFeedback.textContent = "";
        }
    });

    // Phone number validation (only digits, max 10 digits)
    function validatePhone(field, feedback) {
        field.addEventListener("input", () => {
            field.value = field.value.replace(/[^0-9]/g, ""); // Only digits allowed
            if (field.value.length !== 10) {
                feedback.textContent = "❌ Phone number must be 10 digits.";
            } else {
                feedback.textContent = "";
            }
        });
    }

    validatePhone(patientPhone, patientPhoneFeedback);
    validatePhone(emergencyPhone, emergencyPhoneFeedback);
});
</script>
{% endblock %}
